var scapeHtml=require("./scape.htm.js");var _=require("./utils");var dirs={top:0,right:1,bottom:2,left:3};function ScapeRange(t){this._triggers={};var e=this;this.target=t.target;this._input=t.targetInput||{};this._dir=dirs[t.from];this._min=t.min||0;this._max=t.max||1;if(this._dir===undefined){this._dir=3}var i=_.tpl(scapeHtml,{theme:t.theme||"default",from:t.from||"left"});var s=_.node(i);this.target.appendChild(s);this.node=s;this._played=_.child(s,function(t){return _.hasClass(t,"scape-range-played")});this._thumb=_.child(this._played,function(t){return _.hasClass(t,"scape-range-thumb")});if(this._dir%2){this._thumbSize=this._thumb.clientWidth;this._width=s.clientWidth}else{this._thumbSize=this._thumb.clientHeight;this._width=s.clientHeight}var r=function(t){t=t||window.event;e._ommousemove(t)};_.on(s,"mousedown",function(t){t=t||window.event;e._startScreenX=t.screenX;e._startScreenY=t.screenY;e._startPos=e._pos;var i=_.parent(t.target,function(t){return _.hasClass(t,"scape-range-thumb")},true);if(i){t.preventDefault();_.on(window,"mousemove",r)}});_.on(window,"mouseup",function(){_.off(window,"mousemove",r)});this.val(t.value||this._min)}ScapeRange.prototype.setPos=function(t){var e=this._width;if(t<0){t=0}if(t>e-this._thumbSize){t=e-this._thumbSize}var i=this._dir%2===1?"width":"height";this._played.style[i]=t+this._thumbSize+"px";this._pos=t;return t};ScapeRange.prototype._ommousemove=function(t){t.preventDefault();var e=t.screenX,i=t.screenY;var s;switch(this._dir){case 0:s=this._startPos+i-this._startScreenY;break;case 1:s=this._startPos-e+this._startScreenX;break;case 2:s=this._startPos-i+this._startScreenY;break;case 3:s=this._startPos+e-this._startScreenX;break}s=this.setPos(s);var r=s/(this._width-this._thumbSize)*(this._max-this._min)+this._min;if(this._val!==r){this._val=r;this._input.value=r;this.trigger("change")}};ScapeRange.prototype.val=function(){if(!arguments.length){return this._val}else{var t=arguments[0],e=this._min,i=this._max;if(t<e){t=e}if(t>i){t=i}if(t<=i&&t>=e){var s=(t-e)/(i-e)*(this._width-this._thumbSize);this.setPos(s);this._val=t;this._input.value=t}return this}};ScapeRange.prototype.trigger=function(t,e){if(e===undefined){e=this}var i=this._triggers[t]||[];var s;for(var r=0;r<i.length;r++){s=i[r];typeof s==="function"&&s.call(this,e)}};ScapeRange.prototype.on=function(t,e){var i=this._triggers[t]=this._triggers[t]||[];i.push(e)};window.ScapeRange=ScapeRange;